using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace Init.Sigepro.FrontEnd.AppLogic.GestionePagamenti.MIP
{
    using Init.Sigepro.FrontEnd.AppLogic.GestionePresentazioneDomanda;
    using Init.Sigepro.FrontEnd.AppLogic.GestionePresentazioneDomanda.GestioneAnagrafiche;
    using Init.Sigepro.FrontEnd.AppLogic.GestionePresentazioneDomanda.GestioneOneri;
    using Init.Sigepro.FrontEnd.Pagamenti.MIP;
    using Init.Utils;
    using System.IO;
    //------------------------------------------------------------------------------
    // <auto-generated>
    //     Il codice è stato generato da uno strumento.
    //     Versione runtime:4.0.30319.42000
    //
    //     Le modifiche apportate a questo file possono provocare un comportamento non corretto e andranno perse se
    //     il codice viene rigenerato.
    // </auto-generated>
    //------------------------------------------------------------------------------

    using System.Xml.Serialization;

    /// <remarks/>
    [System.CodeDom.Compiler.GeneratedCodeAttribute("xsd", "4.0.30319.33440")]
    [System.SerializableAttribute()]
    [System.Diagnostics.DebuggerStepThroughAttribute()]
    [System.ComponentModel.DesignerCategoryAttribute("code")]
    [System.Xml.Serialization.XmlTypeAttribute(Namespace = "http://www.gruppoinit.it/RicevutaPagamentiMIP")]
    [System.Xml.Serialization.XmlRootAttribute("Ricevuta", Namespace = "http://www.gruppoinit.it/RicevutaPagamentiMIP", IsNullable = false)]
    public partial class RicevutaType
    {

        private int codiceDomandaField;

        private string codiceEnteField;

        private string descrizioneEnteField;

        private RiferimentiUtenteType anagrafeField;

        private RicevutaTypeDatiPagamento datiPagamentoField;

        private ListaOneriPagatiType[] listaOneriPagatiField;

        [Obsolete("Utilizzare aolo per la serializzazione")]
        public RicevutaType()
        {

        }

        public RicevutaType(IDomandaOnlineReadInterface domanda, MIPEsitoPagamento esito, string intestazioneRicevuta)
        {
            this.anagrafe = AdattaAnagrafe(domanda.Anagrafiche.GetRichiedente());
            this.codiceDomanda = domanda.AltriDati.IdPresentazione;
            this.codiceEnte = domanda.AltriDati.AliasComune;
            this.datiPagamento = new RicevutaTypeDatiPagamento{
                Item = new PaymentDataType{
                    Autorizzazione = esito.Autorizzazione,
                    CircuitoAutorizzativo = esito.CircuitoAutorizzativo,
                    CircuitoAutorizzativoD = esito.CircuitoAutorizzativoD,
                    CircuitoSelezionato = esito.CircuitoSelezionato,
                    CircuitoSelezionatoD = esito.CircuitoSelezionatoD,
                    DataOra = esito.DataOra,
                    DataOraOrdine = esito.DataOraOrdine,
                    DataOraTransazione = esito.DataOraTransazione,
                    DatiSpecifici = esito.DatiSpecifici,
                    Esito = esito.Esito,
                    EsitoD = esito.EsitoD,
                    IDOrdine = esito.IDOrdine,
                    IDTransazione = esito.IDTransazione,
                    ImportoAutorizzato = esito.ImportoAutorizzato,
                    ImportoCommissioni = esito.ImportoCommissioni,
                    ImportoTransato = esito.ImportoTransato,
                    NumeroOperazione = esito.NumeroOperazione,
                    PortaleId = esito.PortaleID,
                    SistemaPagamento = esito.SistemaPagamento,
                    SistemaPagamentoD = esito.SistemaPagamentoD,
                    URLCSS = esito.URLCSS                    
                }
            };

            this.descrizioneEnte = "Ente che riceve il pagamento";
            this.IntestazioneRicevuta = intestazioneRicevuta;
            this.listaOneriPagati = GetListaOneriPagati(domanda.Oneri.GetOneriDaIdOperazione(esito.NumeroOperazione));

        }

        private ListaOneriPagatiType[] GetListaOneriPagati(IEnumerable<OnereFrontoffice> oneri)
        {
            return oneri.Select(x => new ListaOneriPagatiType { 
                descrizione = x.Causale.Descrizione,
                identificativo = x.Causale.Codice,
                importo = (decimal)x.ImportoPagato,
                note = x.Note
            }).ToArray();
        }

        private RiferimentiUtenteType AdattaAnagrafe(AnagraficaDomanda anagraficaDomanda)
        {
            var ute = new RiferimentiUtenteType
            {
                codiceFiscale = anagraficaDomanda.Codicefiscale,
                cognome = anagraficaDomanda.Nominativo,
                comuneNascita = anagraficaDomanda.DatiNascita.CodiceComune,
                dataNascitaSpecified = false,
                indirizzo = new LocalizzazioneType
                {
                    cap = anagraficaDomanda.IndirizzoResidenza.Cap,
                    comune = anagraficaDomanda.IndirizzoResidenza.Citta,
                    indirizzo = anagraficaDomanda.IndirizzoResidenza.Via,
                    provincia = anagraficaDomanda.IndirizzoResidenza.SiglaProvincia
                },
                nome = anagraficaDomanda.Nome,
                piva = anagraficaDomanda.PartitaIva
            };

            if (anagraficaDomanda.DatiNascita.Data.HasValue)
            {
                ute.dataNascitaSpecified = true;
                ute.dataNascita = anagraficaDomanda.DatiNascita.Data.Value;
            }

            return ute;
        }


        public string ToXmlString()
        {
            using (var ms = new MemoryStream())
            {
                //XmlTextWriter swXml = new XmlTextWriter(ms, Encoding.UTF8);

                XmlSerializer xs = new XmlSerializer(this.GetType());
                xs.Serialize(ms, this);

                return StreamUtils.StreamToString(ms);
            }
            
        }

        /// <remarks/>
        public int codiceDomanda
        {
            get
            {
                return this.codiceDomandaField;
            }
            set
            {
                this.codiceDomandaField = value;
            }
        }

        /// <remarks/>
        public string codiceEnte
        {
            get
            {
                return this.codiceEnteField;
            }
            set
            {
                this.codiceEnteField = value;
            }
        }

        /// <remarks/>
        public string descrizioneEnte
        {
            get
            {
                return this.descrizioneEnteField;
            }
            set
            {
                this.descrizioneEnteField = value;
            }
        }

        /// <remarks/>
        public RiferimentiUtenteType anagrafe
        {
            get
            {
                return this.anagrafeField;
            }
            set
            {
                this.anagrafeField = value;
            }
        }

        /// <remarks/>
        public RicevutaTypeDatiPagamento datiPagamento
        {
            get
            {
                return this.datiPagamentoField;
            }
            set
            {
                this.datiPagamentoField = value;
            }
        }

        /// <remarks/>
        [System.Xml.Serialization.XmlElementAttribute("listaOneriPagati")]
        public ListaOneriPagatiType[] listaOneriPagati
        {
            get
            {
                return this.listaOneriPagatiField;
            }
            set
            {
                this.listaOneriPagatiField = value;
            }
        }

        public string IntestazioneRicevuta
        {
            get;
            set;
        }
    }

    /// <remarks/>
    [System.CodeDom.Compiler.GeneratedCodeAttribute("xsd", "4.0.30319.33440")]
    [System.SerializableAttribute()]
    [System.Diagnostics.DebuggerStepThroughAttribute()]
    [System.ComponentModel.DesignerCategoryAttribute("code")]
    [System.Xml.Serialization.XmlTypeAttribute(Namespace = "http://www.gruppoinit.it/RicevutaPagamentiMIP")]
    public partial class RiferimentiUtenteType
    {

        private string nomeField;

        private string cognomeField;

        private string codiceFiscaleField;

        private string pivaField;

        private LocalizzazioneType indirizzoField;

        private System.DateTime dataNascitaField;

        private bool dataNascitaFieldSpecified;

        private string comuneNascitaField;

        /// <remarks/>
        public string nome
        {
            get
            {
                return this.nomeField;
            }
            set
            {
                this.nomeField = value;
            }
        }

        /// <remarks/>
        public string cognome
        {
            get
            {
                return this.cognomeField;
            }
            set
            {
                this.cognomeField = value;
            }
        }

        /// <remarks/>
        public string codiceFiscale
        {
            get
            {
                return this.codiceFiscaleField;
            }
            set
            {
                this.codiceFiscaleField = value;
            }
        }

        /// <remarks/>
        public string piva
        {
            get
            {
                return this.pivaField;
            }
            set
            {
                this.pivaField = value;
            }
        }

        /// <remarks/>
        public LocalizzazioneType indirizzo
        {
            get
            {
                return this.indirizzoField;
            }
            set
            {
                this.indirizzoField = value;
            }
        }

        /// <remarks/>
        [System.Xml.Serialization.XmlElementAttribute(DataType = "date")]
        public System.DateTime dataNascita
        {
            get
            {
                return this.dataNascitaField;
            }
            set
            {
                this.dataNascitaField = value;
            }
        }

        /// <remarks/>
        [System.Xml.Serialization.XmlIgnoreAttribute()]
        public bool dataNascitaSpecified
        {
            get
            {
                return this.dataNascitaFieldSpecified;
            }
            set
            {
                this.dataNascitaFieldSpecified = value;
            }
        }

        /// <remarks/>
        public string comuneNascita
        {
            get
            {
                return this.comuneNascitaField;
            }
            set
            {
                this.comuneNascitaField = value;
            }
        }
    }

    /// <remarks/>
    [System.CodeDom.Compiler.GeneratedCodeAttribute("xsd", "4.0.30319.33440")]
    [System.SerializableAttribute()]
    [System.Diagnostics.DebuggerStepThroughAttribute()]
    [System.ComponentModel.DesignerCategoryAttribute("code")]
    [System.Xml.Serialization.XmlTypeAttribute(Namespace = "http://www.gruppoinit.it/RicevutaPagamentiMIP")]
    public partial class LocalizzazioneType
    {

        private string comuneField;

        private string indirizzoField;

        private string capField;

        private string provinciaField;

        /// <remarks/>
        public string comune
        {
            get
            {
                return this.comuneField;
            }
            set
            {
                this.comuneField = value;
            }
        }

        /// <remarks/>
        public string indirizzo
        {
            get
            {
                return this.indirizzoField;
            }
            set
            {
                this.indirizzoField = value;
            }
        }

        /// <remarks/>
        public string cap
        {
            get
            {
                return this.capField;
            }
            set
            {
                this.capField = value;
            }
        }

        /// <remarks/>
        public string provincia
        {
            get
            {
                return this.provinciaField;
            }
            set
            {
                this.provinciaField = value;
            }
        }
    }

    /// <remarks/>
    [System.CodeDom.Compiler.GeneratedCodeAttribute("xsd", "4.0.30319.33440")]
    [System.SerializableAttribute()]
    [System.Diagnostics.DebuggerStepThroughAttribute()]
    [System.ComponentModel.DesignerCategoryAttribute("code")]
    [System.Xml.Serialization.XmlTypeAttribute(Namespace = "http://www.gruppoinit.it/RicevutaPagamentiMIP")]
    public partial class ListaOneriPagatiType
    {

        private int identificativoField;

        private string descrizioneField;

        private decimal importoField;

        private string noteField;

        /// <remarks/>
        public int identificativo
        {
            get
            {
                return this.identificativoField;
            }
            set
            {
                this.identificativoField = value;
            }
        }

        /// <remarks/>
        public string descrizione
        {
            get
            {
                return this.descrizioneField;
            }
            set
            {
                this.descrizioneField = value;
            }
        }

        /// <remarks/>
        public decimal importo
        {
            get
            {
                return this.importoField;
            }
            set
            {
                this.importoField = value;
            }
        }

        /// <remarks/>
        public string note
        {
            get
            {
                return this.noteField;
            }
            set
            {
                this.noteField = value;
            }
        }
    }

    /// <remarks/>
    [System.CodeDom.Compiler.GeneratedCodeAttribute("xsd", "4.0.30319.33440")]
    [System.SerializableAttribute()]
    [System.Diagnostics.DebuggerStepThroughAttribute()]
    [System.ComponentModel.DesignerCategoryAttribute("code")]
    [System.Xml.Serialization.XmlTypeAttribute(Namespace = "http://www.gruppoinit.it/RicevutaPagamentiMIP")]
    public partial class PaymentDataType
    {

        private string portaleIdField;

        private string numeroOperazioneField;

        private string iDOrdineField;

        private string dataOraOrdineField;

        private string iDTransazioneField;

        private string dataOraTransazioneField;

        private string sistemaPagamentoField;

        private string sistemaPagamentoDField;

        private string circuitoAutorizzativoField;

        private string circuitoAutorizzativoDField;

        private string circuitoSelezionatoField;

        private string circuitoSelezionatoDField;

        private string importoTransatoField;

        private string importoAutorizzatoField;

        private string importoCommissioniField;

        private string esitoField;

        private string esitoDField;

        private string dataOraField;

        private string autorizzazioneField;

        private string uRLCSSField;

        private string datiSpecificiField;

        /// <remarks/>
        public string PortaleId
        {
            get
            {
                return this.portaleIdField;
            }
            set
            {
                this.portaleIdField = value;
            }
        }

        /// <remarks/>
        public string NumeroOperazione
        {
            get
            {
                return this.numeroOperazioneField;
            }
            set
            {
                this.numeroOperazioneField = value;
            }
        }

        /// <remarks/>
        public string IDOrdine
        {
            get
            {
                return this.iDOrdineField;
            }
            set
            {
                this.iDOrdineField = value;
            }
        }

        /// <remarks/>
        public string DataOraOrdine
        {
            get
            {
                return this.dataOraOrdineField;
            }
            set
            {
                this.dataOraOrdineField = value;
            }
        }

        /// <remarks/>
        public string IDTransazione
        {
            get
            {
                return this.iDTransazioneField;
            }
            set
            {
                this.iDTransazioneField = value;
            }
        }

        /// <remarks/>
        [System.Xml.Serialization.XmlElementAttribute(IsNullable = true)]
        public string DataOraTransazione
        {
            get
            {
                return this.dataOraTransazioneField;
            }
            set
            {
                this.dataOraTransazioneField = value;
            }
        }

        /// <remarks/>
        public string SistemaPagamento
        {
            get
            {
                return this.sistemaPagamentoField;
            }
            set
            {
                this.sistemaPagamentoField = value;
            }
        }

        /// <remarks/>
        public string SistemaPagamentoD
        {
            get
            {
                return this.sistemaPagamentoDField;
            }
            set
            {
                this.sistemaPagamentoDField = value;
            }
        }

        /// <remarks/>
        public string CircuitoAutorizzativo
        {
            get
            {
                return this.circuitoAutorizzativoField;
            }
            set
            {
                this.circuitoAutorizzativoField = value;
            }
        }

        /// <remarks/>
        public string CircuitoAutorizzativoD
        {
            get
            {
                return this.circuitoAutorizzativoDField;
            }
            set
            {
                this.circuitoAutorizzativoDField = value;
            }
        }

        /// <remarks/>
        public string CircuitoSelezionato
        {
            get
            {
                return this.circuitoSelezionatoField;
            }
            set
            {
                this.circuitoSelezionatoField = value;
            }
        }

        /// <remarks/>
        public string CircuitoSelezionatoD
        {
            get
            {
                return this.circuitoSelezionatoDField;
            }
            set
            {
                this.circuitoSelezionatoDField = value;
            }
        }

        /// <remarks/>
        public string ImportoTransato
        {
            get
            {
                return this.importoTransatoField;
            }
            set
            {
                this.importoTransatoField = value;
            }
        }

        /// <remarks/>
        public string ImportoAutorizzato
        {
            get
            {
                return this.importoAutorizzatoField;
            }
            set
            {
                this.importoAutorizzatoField = value;
            }
        }

        /// <remarks/>
        public string ImportoCommissioni
        {
            get
            {
                return this.importoCommissioniField;
            }
            set
            {
                this.importoCommissioniField = value;
            }
        }

        /// <remarks/>
        public string Esito
        {
            get
            {
                return this.esitoField;
            }
            set
            {
                this.esitoField = value;
            }
        }

        /// <remarks/>
        public string EsitoD
        {
            get
            {
                return this.esitoDField;
            }
            set
            {
                this.esitoDField = value;
            }
        }

        /// <remarks/>
        public string DataOra
        {
            get
            {
                return this.dataOraField;
            }
            set
            {
                this.dataOraField = value;
            }
        }

        /// <remarks/>
        public string Autorizzazione
        {
            get
            {
                return this.autorizzazioneField;
            }
            set
            {
                this.autorizzazioneField = value;
            }
        }

        /// <remarks/>
        public string URLCSS
        {
            get
            {
                return this.uRLCSSField;
            }
            set
            {
                this.uRLCSSField = value;
            }
        }

        /// <remarks/>
        public string DatiSpecifici
        {
            get
            {
                return this.datiSpecificiField;
            }
            set
            {
                this.datiSpecificiField = value;
            }
        }
    }

    /// <remarks/>
    [System.CodeDom.Compiler.GeneratedCodeAttribute("xsd", "4.0.30319.33440")]
    [System.SerializableAttribute()]
    [System.Diagnostics.DebuggerStepThroughAttribute()]
    [System.ComponentModel.DesignerCategoryAttribute("code")]
    [System.Xml.Serialization.XmlTypeAttribute(AnonymousType = true, Namespace = "http://www.gruppoinit.it/RicevutaPagamentiMIP")]
    public partial class RicevutaTypeDatiPagamento
    {

        private object itemField;

        /// <remarks/>
        [System.Xml.Serialization.XmlElementAttribute("mipPaymentData", typeof(PaymentDataType))]
        [System.Xml.Serialization.XmlElementAttribute("nonDefinito", typeof(string))]
        public object Item
        {
            get
            {
                return this.itemField;
            }
            set
            {
                this.itemField = value;
            }
        }
    }

}
