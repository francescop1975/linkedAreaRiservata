using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace Init.Sigepro.FrontEnd.Pagamenti.ESED
{
    using Init.Sigepro.FrontEnd.Infrastructure.UrlsAndPaths;
    using Init.Sigepro.FrontEnd.Pagamenti.MIP;
    using System.IO;
    using System.Runtime.Serialization;
    using System.Xml;
    //------------------------------------------------------------------------------
    // <auto-generated>
    //     Il codice è stato generato da uno strumento.
    //     Versione runtime:4.0.30319.42000
    //
    //     Le modifiche apportate a questo file possono provocare un comportamento non corretto e andranno perse se
    //     il codice viene rigenerato.
    // </auto-generated>
    //------------------------------------------------------------------------------

    using System.Xml.Serialization;

    // 
    // This source code was auto-generated by xsd, Version=4.0.30319.33440.
    // 


    public class PaymentRequestEsed
    {

    }
    /// <remarks/>
    [DataContract(Namespace = "", Name = "PaymentRequest")]
    public partial class PaymentRequestESED
    {
        [DataMember]
        public string PortaleID
        {
            get;
            protected set;
        }

        /// <remarks/>
        [DataMember]
        public string Funzione
        {
            get;
            protected set;
        }

        /// <remarks/>
        [DataMember]
        public string URLDiRitorno
        {
            get;
            protected set;
        }

        /// <remarks/>
        [DataMember]
        public string URLDiNotifica
        {
            get;
            protected set;
        }

        /// <remarks/>
        [DataMember]
        public string URLBack
        {
            get;
            protected set;
        }

        /// <remarks/>
        [DataMember]
        public string CommitNotifica
        {
            get;
            protected set;
        }

        /// <remarks/>
        [DataMember]
        public PaymentRequestUserData UserData
        {
            get;
            protected set;
        }

        /// <remarks/>
        [DataMember]
        public PaymentRequestServiceData ServiceData
        {
            get;
            protected set;
        }

        [DataMember]
        public PaymentRequestAccountingData AccountingData
        {
            get;
            protected set;
        }

        [DataContract(Namespace = "")]
        public partial class PaymentRequestAccountingData
        {
            [DataMember]
            public AccountingDataImportiContabili ImportiContabili { get; set; }

            [DataMember]
            public AccountingDataEntiDestinatari EntiDestinatari { get; set; }
        }

        [DataContract(Namespace = "")]
        public partial class AccountingDataImportiContabili
        {
            [DataMember]
            public ImportiContabiliImportoContabile ImportoContabile { get; set; }
        }

        [DataContract(Namespace = "")]
        public partial class ImportiContabiliImportoContabile
        {
            [DataMember]
            public string Identificativo { get; set; }

            [DataMember]
            public string Valore { get; set; }
        }

        [DataContract(Namespace = "")]
        public partial class AccountingDataEntiDestinatari
        {
            [DataMember]
            public EntiDestinatariEnteDestinatario EnteDestinatario { get; set; }
        }

        [DataContract(Namespace = "")]
        public partial class EntiDestinatariEnteDestinatario
        {
            [DataMember]
            public string CodiceEntePortaleEsterno { get; set; }

            [DataMember]
            public string DescrEntePortaleEsterno { get; set; }

            [DataMember]
            public string Valore { get; set; }

            [DataMember]
            public string Causale { get; set; }

            [DataMember]
            public string ImportoContabileIngresso { get; set; }

            [DataMember]
            public string ImportoContabileUscita { get; set; }
        }


        [DataContract(Namespace = "")]
        public partial class PaymentRequestUserData
        {
            /// <remarks/>
            [DataMember]
            public string EmailUtente
            {
                get;
                set;
            }

            /// <remarks/>
            [DataMember]
            public string IdentificativoUtente
            {
                get;
                set;
            }

        }

        [DataContract(Namespace = "")]
        public partial class PaymentRequestServiceData
        {
            /// <remarks/>
            [DataMember]
            public string CodiceUtente { get; set; }

            [DataMember]
            public string CodiceEnte { get; set; }

            [DataMember]
            public string TipoUfficio { get; set; }

            [DataMember]
            public string CodiceUfficio { get; set; }

            [DataMember]
            public string TipologiaServizio { get; set; }

            [DataMember]
            public string NumeroOperazione { get; set; }

            [DataMember]
            public string NumeroDocumento { get; set; }

            [DataMember]
            public string AnnoDocumento { get; set; }

            [DataMember]
            public string Valuta { get; set; }

            [DataMember]
            public string Importo { get; set; }

            [DataMember]
            public string DatiSpecifici { get; set; }
        }


        private static class Constants
        {
            public const string Funzione = "PAGAMENTO";
            public const string NotificaEsitiNegativi = "S";
            public const string RitornaDatiSpecifici = "S";
            public const string ImportoCommissioni = "";
            public const string CalcoloCommissioni = "S";
            public const string CommitNotifica = "S";

            public const string TokenId = "";
        }

        IUrlEncoder _urlEncoder = new HttpUtilityUrlEncoder();
        IResolveUrl _resolveUrl = new HttpContextResolveUrl();

        [Obsolete("Utilizzare solo per la serializzazione")]
        public PaymentRequestESED()
        {

        }

        public PaymentRequestESED(PaymentRequest request)
        {
            this.PortaleID = request.PortaleID;
            this.Funzione = Constants.Funzione;
            this.URLDiRitorno = request.URLDiRitorno;
            this.URLDiNotifica = request.URLDiNotifica;
            this.URLBack = request.URLBack;
            this.CommitNotifica = Constants.CommitNotifica;
            this.UserData = new PaymentRequestUserData
            {
                EmailUtente = request.UserData.EmailUtente,
                IdentificativoUtente = request.UserData.IdentificativoUtente
            };

            this.ServiceData = new PaymentRequestServiceData
            {
                CodiceUtente = request.Settings.CodiceUtente,
                CodiceEnte = request.Settings.CodiceEnte,
                TipoUfficio = request.Settings.TipoUfficio,
                CodiceUfficio = request.Settings.CodiceUfficio,
                TipologiaServizio = request.Settings.TipologiaServizio,
                NumeroOperazione = request.PaymentData.NumeroOperazione,
                NumeroDocumento = DateTime.Now.ToString("ddMMyyyy-HHmmss"),
                AnnoDocumento = DateTime.Now.Year.ToString(),
                Valuta = request.PagamentoRequest.RiferimentiOperazione.Valuta,
                Importo = request.PagamentoRequest.RiferimentiOperazione.Importo
            };

        }



        internal string ToXmlString()
        {
            using (var stringwriter = new StringWriter())
            {
                var serializer = new DataContractSerializer(this.GetType());
                using (var output = new StringWriter())
                {
                    using (var writer = new XmlTextWriter(output) { Formatting = Formatting.Indented })
                    {
                        serializer.WriteObject(writer, this);

                        var retVal = output.GetStringBuilder().ToString().Replace("<?xml version=\"1.0\" encoding=\"UTF - 8\"?>", "");

                        return retVal;
                    }
                }
            }
        }
    }
}